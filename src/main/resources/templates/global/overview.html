<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/global}">
<th:block layout:fragment="style">
</th:block>
<div layout:fragment="content">
    <!-- Content -->
    <div id="content">
        <article class="view">
            <h3>Container Platform Info</h3>
            <div class="flex-s">
                <div>
                    <dl>
                        <dt>Cluster</dt>
                        <dd id="clusterStatus">0</dd>
                    </dl>
                    <dl>
                        <dt>Namespace</dt>
                        <dd id="namespaceStatus">0</dd>
                    </dl>
                    <dl>
                        <dt>PV</dt>
                        <dd id="pvStatus">0</dd>
                    </dl>
                    <dl>
                        <dt>PVC</dt>
                        <dd id="pvcStatus">0</dd>
                    </dl>
                    <dl>
                        <dt>Pod</dt>
                        <dd id="podStatus">0</dd>
                    </dl>
                </div>
            </div>
        </article>
        <article class="base base-type2">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Cluster Usage</h3>
                    <!-- /.card -->
                </div>
                <!-- /.card-header -->
                <div class="card-body p-0">
                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th>클러스터</th>
                            <th>프로바이더</th>
                            <th>k8s 버전</th>
                            <th>노드</th>
                            <th>네임스페이스</th>
                            <th>파드</th>
                            <th>CPU</th>
                            <th>Memory</th>
                        </tr>
                        </thead>
                        <tbody class="clusterListTable">
                        </tbody>
                    </table>
                </div>
                <!-- /.card-body -->
            </div>
        </article>
        <article class="base-type3">
            <div class="chart">
                <h4><span>Node TOP 10</span></h4>
                <ul>
                    <li id="topNodesCpu">
                        <h5>CPU</h5>
                        <div class="table_style01">
                            <table>
                                <colgroup >
                                    <col />
                                    <col />
                                    <col />
                                    <col />
                                    <col />
                                    <col />
                                </colgroup>
                                <thead>
                                <tr>
                                    <th scope="col">클러스터</th>
                                    <th scope="col">노드</th>
                                    <th scope="col">CPU(cores)</th>
                                    <th scope="col">CPU%</th>
                                    <th scope="col">MEMORY(bytes)</th>
                                    <th scope="col">MEMORY%</th>
                                </tr>
                                </thead>
                            <tbody class="topNodesCpuListTable">
                            </tbody>
                        </table>
                        </div>
                    </li>
                </ul>
                <ul>
                    <li id="topNodesMem">
                        <h5>Memory</h5>
                        <div class="table_style01">
                            <table>
                                <colgroup >
                                    <col />
                                    <col />
                                    <col />
                                    <col />
                                    <col />
                                    <col />
                                </colgroup>
                                <thead>
                                <tr>
                                    <th scope="col">클러스터</th>
                                    <th scope="col">노드</th>
                                    <th scope="col">CPU(cores)</th>
                                    <th scope="col">CPU%</th>
                                    <th scope="col">MEMORY(bytes)</th>
                                    <th scope="col">MEMORY%</th>
                                </tr>
                                </thead>
                                <tbody class="topNodesMemListTable">
                                </tbody>
                            </table>
                        </div>
                    </li>
                </ul>
            </div>
        </article>
    </div>
    <!-- // Content -->
</div>

<th:block layout:fragment="script">
<!-- jQuery -->
<script src="/plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap -->
<script src="/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- jQuery Knob -->
<script src="/plugins/jquery-knob/jquery.knob.min.js"></script>
<!-- AdminLTE -->
<script src="/dist/js/adminlte.js"></script>
<!-- ChartJS -->
<script src="/plugins/chart.js/Chart.min.js"></script>
<script type="text/javascript">
        window.onload = () => {
            IS_GLOBAL = true;
            IS_OVERVIEW = true;
            func.init();
            callbackFuncNameLoad();

            const overview = {
                init() {
                    func.nameLoad = overview.load;
                },

                load() {
                    func.loading();

                    // nameSpace 정보 조회
                   func.loadData('GET', `${func.url}global/overview`, 'application/json', overview.draw);
                    IS_OVERVIEW = false;
                },

                draw(data) {

                    var legends = document.querySelectorAll('.legend');

                    for (var i = 0; i < legends.length; i++) {
                        func.removeHtml(legends[i]);
                    }
                    ;

                    if (data.httpStatusCode == 500) {

                    }



                    if(data.httpStatusCode == 200){

                        // all count status
                        func.countUp(document.getElementById('clusterStatus'), data.clusterStatus);
                        func.countUp(document.getElementById('namespaceStatus'), data.namespaceStatus);
                        func.countUp(document.getElementById('pvStatus'), data.pvStatus);
                        func.countUp(document.getElementById('pvcStatus'), data.pvcStatus);
                        func.countUp(document.getElementById('podStatus'), data.podStatus);

                        // cluster info list
                        if(data.items.length > 0){
                            for(var i=0; i<=data.items.length-1; i++){
                                   var item = data.items[i];
                                var html = `<tr><td class="left" style=" white-space: normal;">${item.clusterName}</td>` +
                                    `<td class="center">${item.clusterProviderType}</td>`+
                                    `<td class="center">${item.version}</td>`+
                                    `<td class="center">${item.nodeCount.count}/${item.nodeCount.all}</td>`+
                                    `<td class="center">${item.namespaceCount.count}/${item.namespaceCount.all}</td>`+
                                    `<td class="center">${item.podCount.count}/${item.podCount.all}</td>`+
                                    `<td class="center">${item.usage.cpu}</td>`+
                                    `<td class="center">${item.usage.memory}</td></tr>`;

                                func.appendHtml(document.querySelector('.clusterListTable'), html, 'tbody');
                            };
                        } else {
                            var html = '<tr><td colspan="10">No Data.</td></tr>';
                            func.appendHtml(document.querySelector('.clusterListTable'), html, 'tbody');
                        };



                        // top node cpu
                        if(data.topNodesCPU.length > 0){
                            for(var i=0; i<=data.topNodesCPU.length-1; i++){
                                var item = data.topNodesCPU[i];
                                var html = `<tr><td class="center">${item.clusterName}</td>` +
                                    `<td class="center">${item.name}</td>`+
                                    `<td class="center">${item.cpu.usage}</td>`+
                                    `<td class="center">${item.cpu.percent}</td>` +
                                    `<td class="center">${item.memory.usage}</td>` +
                                    `<td class="center">${item.memory.percent}</td></tr>`;

                                func.appendHtml(document.querySelector('.topNodesCpuListTable'), html, 'tbody');
                            };
                        } else {
                            var html = '<tr><td colspan="6">No Data.</td></tr>';
                            func.appendHtml(document.querySelector('.topNodesCpuListTable'), html, 'tbody');
                        };


                        // top node memory
                        if(data.topNodesMEM.length > 0){
                            for(var i=0; i<=data.topNodesMEM.length-1; i++){
                                var item = data.topNodesMEM[i];
                                var html = `<tr><td class="center">${item.clusterName}</td>` +
                                    `<td class="center">${item.name}</td>`+
                                    `<td class="center">${item.cpu.usage}</td>`+
                                    `<td class="center">${item.cpu.percent}</td>` +
                                    `<td class="center">${item.memory.usage}</td>` +
                                    `<td class="center">${item.memory.percent}</td></tr>`;

                                func.appendHtml(document.querySelector('.topNodesMemListTable'), html, 'tbody');
                            };
                        } else {
                            var html = '<tr><td colspan="6">No Data.</td></tr>';
                            func.appendHtml(document.querySelector('.topNodesMemListTable'), html, 'tbody');
                        };


                    }
                    else {
                        var html = '<tr><td colspan="10">No Data.</td></tr>';
                        func.appendHtml(document.querySelector('.clusterListTable'), html, 'tbody');
                    }



                    document.getElementById('wrap').removeChild(document.getElementById('loading'));
                },
            }

            overview.init();
        }

    </script>
<!-- Percent-->
<script>
        $(function () {
            /* jQueryKnob */

            $('.knob').knob({
                /*change : function (value) {
                 //console.log("change : " + value);
                 },
                 release : function (value) {
                 console.log("release : " + value);
                 },
                 cancel : function () {
                 console.log("cancel : " + this.value);
                 },*/
                draw: function () {

                    // "tron" case
                    if (this.$.data('skin') == 'tron') {

                        var a   = this.angle(this.cv)  // Angle
                            ,
                            sa  = this.startAngle          // Previous start angle
                            ,
                            sat = this.startAngle         // Start angle
                            ,
                            ea                            // Previous end angle
                            ,
                            eat = sat + a                 // End angle
                            ,
                            r   = true

                        this.g.lineWidth = this.lineWidth

                        this.o.cursor
                        && (sat = eat - 0.3)
                        && (eat = eat + 0.3)

                        if (this.o.displayPrevious) {
                            ea = this.startAngle + this.angle(this.value)
                            this.o.cursor
                            && (sa = ea - 0.3)
                            && (ea = ea + 0.3)
                            this.g.beginPath()
                            this.g.strokeStyle = this.previousColor
                            this.g.arc(this.xy, this.xy, this.radius - this.lineWidth, sa, ea, false)
                            this.g.stroke()
                        }

                        this.g.beginPath()
                        this.g.strokeStyle = r ? this.o.fgColor : this.fgColor
                        this.g.arc(this.xy, this.xy, this.radius - this.lineWidth, sat, eat, false)
                        this.g.stroke()

                        this.g.lineWidth = 2
                        this.g.beginPath()
                        this.g.strokeStyle = this.o.fgColor
                        this.g.arc(this.xy, this.xy, this.radius - this.lineWidth + 1 + this.lineWidth * 2 / 3, 0, 2 * Math.PI, false)
                        this.g.stroke()

                        return false
                    }
                }
            })
            /* END JQUERY KNOB */
        })

    </script>
<!-- Bar-->
    <script>
        $(function () {
            /* ChartJS
             * -------
             * Here we will create a few charts using ChartJS
             */

            //--------------
            //- AREA CHART -
            //--------------

            // Get context with jQuery - using jQuery's .get() method.
            var areaChartData = {
                labels  : ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
                datasets: [
                    {
                        label               : 'Digital Goods',
                        backgroundColor     : 'rgba(60,141,188,0.9)',
                        borderColor         : 'rgba(60,141,188,0.8)',
                        pointRadius          : false,
                        pointColor          : '#3b8bba',
                        pointStrokeColor    : 'rgba(60,141,188,1)',
                        pointHighlightFill  : '#fff',
                        pointHighlightStroke: 'rgba(60,141,188,1)',
                        data                : [28, 48, 40, 19, 86, 27, 90]
                    },
                    {
                        label               : 'Electronics',
                        backgroundColor     : 'rgba(210, 214, 222, 1)',
                        borderColor         : 'rgba(210, 214, 222, 1)',
                        pointRadius         : false,
                        pointColor          : 'rgba(210, 214, 222, 1)',
                        pointStrokeColor    : '#c1c7d1',
                        pointHighlightFill  : '#fff',
                        pointHighlightStroke: 'rgba(220,220,220,1)',
                        data                : [65, 59, 80, 81, 56, 55, 40]
                    },
                ]
            }

            var areaChartOptions = {
                maintainAspectRatio : false,
                responsive : true,
                legend: {
                    display: false
                },
                scales: {
                    xAxes: [{
                        gridLines : {
                            display : false,
                        }
                    }],
                    yAxes: [{
                        gridLines : {
                            display : false,
                        }
                    }]
                }
            }


            //-------------
            //- BAR CHART -
            //-------------
            var barChartCanvas = $('#barChart').get(0).getContext('2d')
            var barChartData = $.extend(true, {}, areaChartData)
            var temp0 = areaChartData.datasets[0]
            var temp1 = areaChartData.datasets[1]
            barChartData.datasets[0] = temp1
            barChartData.datasets[1] = temp0

            var barChartOptions = {
                responsive              : true,
                maintainAspectRatio     : false,
                datasetFill             : false
            }

            new Chart(barChartCanvas, {
                type: 'bar',
                data: barChartData,
                options: barChartOptions
            })

        })
    </script>
</th:block>
</html>